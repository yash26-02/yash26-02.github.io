<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YG MASTER PANEL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; }
        .card { background: #080808; border: 1px solid #1a1a1a; padding: 20px; border-radius: 20px; }
        .active-btn { border: 2px solid white; box-shadow: 0 0 10px white; opacity: 1 !important; }
        /* Naye Button Styles */
        .btn-approve { background: #064e3b; color: #10b981; border: 1px solid #10b981; padding: 2px 8px; border-radius: 5px; font-weight: bold; font-size: 10px; }
        .btn-reject { background: #7f1d1d; color: #f87171; border: 1px solid #f87171; padding: 2px 8px; border-radius: 5px; font-weight: bold; font-size: 10px; }
    </style>
</head>
<body class="p-4">

    <div id="lock" class="max-w-sm mx-auto mt-20 border border-green-900 p-8 rounded-3xl text-center">
        <h1 class="text-xl mb-6">ADMIN KEY</h1>
        <input type="password" id="adm-pass" class="w-full bg-black border border-green-900 p-4 rounded-xl mb-6 text-center text-green-500 outline-none">
        <button onclick="auth()" class="w-full bg-green-700 text-black font-bold py-4 rounded-xl">OPEN PANEL</button>
    </div>

    <div id="panel" class="hidden max-w-2xl mx-auto space-y-6">
        <div class="card text-center border-green-700">
            <p id="adm-period" class="text-[10px] text-zinc-500">PERIOD: ----</p>
            <h1 id="adm-timer" class="text-5xl font-bold text-white my-2">00:00</h1>
            <div class="grid grid-cols-2 gap-4 mt-4">
                <div class="p-2 border border-orange-900 rounded-lg">
                    <p class="text-[10px]">BIG BETS</p>
                    <h2 id="total-big" class="text-xl font-bold text-orange-500">₹0</h2>
                </div>
                <div class="p-2 border border-indigo-900 rounded-lg">
                    <p class="text-[10px]">SMALL BETS</p>
                    <h2 id="total-small" class="text-xl font-bold text-indigo-500">₹0</h2>
                </div>
            </div>
        </div>

        <div class="card border-red-900 text-center">
            <h2 class="text-xs mb-4 text-red-500">NEXT RESULT CONTROL (AUTO-RESET)</h2>
            <div class="grid grid-cols-2 gap-4">
                <button id="ctrl-Big" onclick="setF('Big')" class="bg-orange-600 text-white p-4 rounded-xl font-bold opacity-30">BIG</button>
                <button id="ctrl-Small" onclick="setF('Small')" class="bg-indigo-600 text-white p-4 rounded-xl font-bold opacity-30">SMALL</button>
            </div>
            <p id="mode-text" class="mt-4 text-[10px] text-yellow-500 uppercase">MODE: RANDOM</p>
        </div>

        <div class="card">
            <h2 class="text-xs mb-4 text-blue-500">SET DEPOSIT QR</h2>
            <input type="file" id="qr-file" class="text-xs mb-4 block w-full">
            <button onclick="upQR()" class="w-full bg-blue-800 text-white py-3 rounded-xl font-bold text-xs">UPLOAD & SET QR</button>
        </div>

        <div class="card">
            <h2 class="text-xs mb-4 text-yellow-500">PENDING REQUESTS</h2>
            <div id="req-list" class="space-y-3"></div>
        </div>
        
        <div class="card">
            <h2 class="text-xs mb-4 text-green-500 italic">USER DATABASE</h2>
            <div id="user-list" class="text-[10px] space-y-1"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBdro-HbE-RSNvx4-ftDTTVLEH9ZAlmCBA",
            databaseURL: "https://yggame-23e85-default-rtdb.firebaseio.com",
            projectId: "yggame-23e85",
            appId: "1:805643944561:web:e445cb4d236b3e731c51d0"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function auth() { if(document.getElementById('adm-pass').value === 'myselfyg26') { document.getElementById('lock').classList.add('hidden'); document.getElementById('panel').classList.remove('hidden'); load(); } }

        function setF(v) { 
            db.ref('control/force').set(v); 
            alert(v + " Selected! Result will reset to Random after this minute.");
        }

        function load() {
            setInterval(() => {
                const now = new Date();
                const ist = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Kolkata"}));
                const sec = ist.getSeconds();
                const rem = 60 - sec;
                const totalMin = ist.getHours() * 60 + ist.getMinutes();
                const pId = ist.toISOString().slice(0,10).replace(/-/g,"") + "1000" + (10001 + totalMin - 330);
                
                document.getElementById('adm-period').innerText = "PERIOD: " + pId;
                document.getElementById('adm-timer').innerText = `00:${rem < 10 ? '0'+rem : rem}`;

                if(sec === 0) { 
                    db.ref('control/force').set('Random'); 
                    db.ref('live_bets').remove(); 
                }
            }, 1000);

            db.ref('control/force').on('value', s => {
                let v = s.val() || 'Random';
                document.getElementById('mode-text').innerText = "MODE: " + v;
                document.getElementById('ctrl-Big').className = v === 'Big' ? 'bg-orange-600 text-white p-4 rounded-xl font-bold active-btn' : 'bg-orange-600 text-white p-4 rounded-xl font-bold opacity-30';
                document.getElementById('ctrl-Small').className = v === 'Small' ? 'bg-indigo-600 text-white p-4 rounded-xl font-bold active-btn' : 'bg-indigo-600 text-white p-4 rounded-xl font-bold opacity-30';
            });

            db.ref('live_bets').on('value', s => {
                let d = s.val(), bT = 0, sT = 0;
                for(let k in d) { if(d[k].type === 'Big') bT += d[k].amt; else sT += d[k].amt; }
                document.getElementById('total-big').innerText = "₹" + bT;
                document.getElementById('total-small').innerText = "₹" + sT;
            });

            db.ref().on('value', s => {
                let d = s.val(), h = '', r = '';
                let u = d.users;
                for(let k in u) h += `<div>${k} | BAL: ₹${u[k].wallet.toFixed(1)}</div>`;
                document.getElementById('user-list').innerHTML = h;

                let deps = d.deposits || {}, wits = d.withdraws || {};
                
                // DEPOSIT REQUESTS WITH APPROVE/REJECT
                for(let k in deps) if(deps[k].status === 'Pending') r += `
                <div class="border border-zinc-900 p-2 text-[10px] mb-2">
                    DEP: ${deps[k].phone} | ₹${deps[k].amt} | UTR: ${deps[k].utr}
                    <div class="flex gap-2 mt-1">
                        <button onclick="appD('${k}',true)" class="btn-approve">Approve</button>
                        <button onclick="appD('${k}',false)" class="btn-reject">Reject</button>
                    </div>
                </div>`;
                
                // WITHDRAW REQUESTS WITH APPROVE/REJECT
                for(let k in wits) if(wits[k].status === 'Pending') r += `
                <div class="border border-zinc-900 p-2 text-[10px] mb-2">
                    WIT: <span class="text-white">${wits[k].name}</span> | ${wits[k].phone} | ₹${wits[k].amt}
                    <div class="flex gap-2 mt-1">
                        <button onclick="appW('${k}',true)" class="btn-approve">Approve</button>
                        <button onclick="appW('${k}',false)" class="btn-reject">Reject</button>
                    </div>
                </div>`;
                
                document.getElementById('req-list').innerHTML = r || 'NO REQUESTS';
            });
        }

        function appD(id, status) {
            if(status) {
                db.ref('deposits/'+id).once('value', sn => {
                    let r = sn.val();
                    db.ref('users/'+r.phone+'/wallet').once('value', w => {
                        db.ref('users/'+r.phone+'/wallet').set((w.val()||0)+r.amt);
                        db.ref('deposits/'+id+'/status').set('Success');
                    });
                });
            } else {
                db.ref('deposits/'+id+'/status').set('Rejected');
            }
        }

        function appW(id, status) {
            if(status) {
                db.ref('withdraws/'+id+'/status').set('Success');
            } else {
                // Refund money back to user if rejected
                db.ref('withdraws/'+id).once('value', sn => {
                    let r = sn.val();
                    db.ref('users/'+r.phone+'/wallet').once('value', wSnap => {
                        db.ref('users/'+r.phone+'/wallet').set((wSnap.val() || 0) + r.amt);
                        db.ref('withdraws/'+id+'/status').set('Rejected');
                    });
                });
            }
        }

        function upQR() {
            let f = document.getElementById('qr-file').files[0];
            if(!f) return alert("Select Photo!");
            let rd = new FileReader();
            rd.onload = (e) => { db.ref('control/qr').set(e.target.result); alert("QR SET!"); }
            rd.readAsDataURL(f);
        }
    </script>
</body>
</html>
