<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASTER ADMIN CONTROL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; }
        .card { background: #080808; border: 1px solid #222; padding: 20px; border-radius: 20px; margin-bottom: 15px; }
        .btn-green { background: #053b05; border: 1px solid #0f0; color: #0f0; padding: 5px 15px; border-radius: 5px; }
        .btn-red { background: #3b0505; border: 1px solid #f00; color: #f00; padding: 5px 15px; border-radius: 5px; }
    </style>
</head>
<body class="p-4">

    <div id="lock" class="max-w-sm mx-auto mt-20 card text-center">
        <h1 class="mb-4">MASTER KEY</h1>
        <input type="password" id="adm-pass" class="w-full bg-black border border-green-900 p-3 mb-4 text-center text-green-500">
        <button onclick="auth()" class="w-full bg-green-700 text-black font-bold py-3">LOGIN</button>
    </div>

    <div id="panel" class="hidden max-w-2xl mx-auto">
        <div class="card text-center border-blue-900">
            <h1 id="adm-timer" class="text-4xl font-bold text-white">00:00</h1>
            <div class="grid grid-cols-2 gap-4 mt-4">
                <div class="text-orange-500">BIG: <span id="t-big">₹0</span></div>
                <div class="text-indigo-500">SMALL: <span id="t-small">₹0</span></div>
            </div>
        </div>

        <div class="card text-center">
            <p class="text-[10px] mb-2">NEXT RESULT</p>
            <div class="flex gap-4">
                <button onclick="setF('Big')" class="flex-1 bg-orange-700 text-white py-4 font-bold rounded-xl">BIG</button>
                <button onclick="setF('Small')" class="flex-1 bg-indigo-700 text-white py-4 font-bold rounded-xl">SMALL</button>
            </div>
            <button onclick="setF('Random')" class="mt-4 text-[10px] underline">RESET RANDOM</button>
        </div>

        <div class="card border-yellow-700">
            <h2 class="text-yellow-500 text-xs mb-4 uppercase">Pending Requests</h2>
            <div id="req-list" class="space-y-4 text-[10px]"></div>
        </div>

        <div class="card">
            <h2 class="text-blue-500 text-xs mb-2">QR UPDATE</h2>
            <input type="file" id="qrf" class="text-xs mb-2">
            <button onclick="upQR()" class="w-full bg-blue-900 text-white py-2 text-xs">SET NEW QR</button>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBdro-HbE-RSNvx4-ftDTTVLEH9ZAlmCBA", databaseURL: "https://yggame-23e85-default-rtdb.firebaseio.com", projectId: "yggame-23e85", appId: "1:805643944561:web:e445cb4d236b3e731c51d0" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function auth() { if(document.getElementById('adm-pass').value === 'myselfyg26') { document.getElementById('lock').classList.add('hidden'); document.getElementById('panel').classList.remove('hidden'); load(); } }

        function setF(v) { db.ref('control/force').set(v); alert(v + " Set!"); }

        function load() {
            setInterval(() => {
                const now = new Date(); const ist = new Date(now.toLocaleString("en-US",{timeZone:"Asia/Kolkata"})); const sec = ist.getSeconds();
                document.getElementById('adm-timer').innerText = `00:${60-sec}`;
                if(sec===0) { db.ref('control/force').set('Random'); db.ref('live_bets').remove(); }
            }, 1000);

            db.ref('live_bets').on('value', s=>{
                let d=s.val(), b=0, sm=0; for(let k in d){ if(d[k].type==='Big') b+=d[k].amt; else sm+=d[k].amt; }
                document.getElementById('t-big').innerText="₹"+b; document.getElementById('t-small').innerText="₹"+sm;
            });

            db.ref().on('value', s=>{
                let d=s.val(), r='', deps=d.deposits||{}, wits=d.withdraws||{};
                for(let k in deps) if(deps[k].status==='Pending') r+=`
                    <div class="border border-zinc-800 p-2 rounded">
                        DEP | ${deps[k].phone} | ₹${deps[k].amt} | UTR: ${deps[k].utr}
                        <div class="flex gap-2 mt-2">
                            <button onclick="action('deposits','${k}',true)" class="btn-green">APPROVE</button>
                            <button onclick="action('deposits','${k}',false)" class="btn-red">REJECT</button>
                        </div>
                    </div>`;
                for(let k in wits) if(wits[k].status==='Pending') r+=`
                    <div class="border border-zinc-800 p-2 rounded">
                        WIT | ${wits[k].name} | ₹${wits[k].amt} | UPI: ${wits[k].upi}
                        <div class="flex gap-2 mt-2">
                            <button onclick="action('withdraws','${k}',true)" class="btn-green">APPROVE</button>
                            <button onclick="action('withdraws','${k}',false)" class="btn-red">REJECT</button>
                        </div>
                    </div>`;
                document.getElementById('req-list').innerHTML = r || 'NO PENDING REQUESTS';
            });
        }

        function action(path, id, success) {
            db.ref(path+'/'+id).once('value', sn=>{
                let d=sn.val();
                if(path==='deposits'){
                    if(success){
                        db.ref('users/'+d.phone+'/wallet').once('value', w=>{ db.ref('users/'+d.phone+'/wallet').set((w.val()||0)+d.amt); });
                        db.ref(path+'/'+id+'/status').set('Success');
                    } else { db.ref(path+'/'+id+'/status').set('Rejected'); }
                } else {
                    if(success){ db.ref(path+'/'+id+'/status').set('Success'); }
                    else {
                        db.ref('users/'+d.phone+'/wallet').once('value', w=>{ db.ref('users/'+d.phone+'/wallet').set((w.val()||0)+d.amt); });
                        db.ref(path+'/'+id+'/status').set('Rejected');
                        alert("Rejected & Refunded!");
                    }
                }
            });
        }

        function upQR() {
            let f = document.getElementById('qrf').files[0]; let rd = new FileReader();
            rd.onload = (e)=>{ db.ref('control/qr').set(e.target.result); alert("QR SET!"); }; rd.readAsDataURL(f);
        }
    </script>
</body>
</html>
