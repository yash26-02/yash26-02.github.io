<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YGWIN | The Ultimate Global Prediction Pro</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ========================================
           1. MASTER CSS VARIABLES (COLOR PALETTE)
           ========================================
        */
        :root {
            --neon-gold: #f3ba2f;
            --gold-dark: #b8860b;
            --deep-black: #050505;
            --card-bg: #121212;
            --win-green: #00ff88;
            --loss-red: #ff3355;
            --pure-white: #ffffff;
            --text-gray: #a0a0a0;
            --admin-blue: #007bff;
            --glass: rgba(255, 255, 255, 0.03);
            --sidebar-width: 280px;
            --transition-speed: 0.4s;
        }

        /* ========================================
           2. GLOBAL RESET & BASE STYLES
           ========================================
        */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        body {
            background: var(--deep-black);
            color: var(--pure-white);
            font-family: 'Rajdhani', sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
            height: 100vh;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--neon-gold); border-radius: 10px; }

        /* ========================================
           3. ANIMATIONS ENGINE
           ========================================
        */
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes glowPulse { 0% { box-shadow: 0 0 5px var(--neon-gold); } 50% { box-shadow: 0 0 20px var(--neon-gold); } 100% { box-shadow: 0 0 5px var(--neon-gold); } }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }

        /* ========================================
           4. LAYOUT COMPONENTS
           ========================================
        */
        .app-shell {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            background: #000;
            position: relative;
            border-left: 1px solid #1a1a1a;
            border-right: 1px solid #1a1a1a;
            box-shadow: 0 0 50px rgba(0,0,0,1);
        }

        .view {
            display: none;
            padding: 20px;
            padding-bottom: 100px; /* Space for navbar */
        }

        .view.active {
            display: block;
            animation: slideUp var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ========================================
           5. AUTHENTICATION PAGES (REG/LOGIN)
           ========================================
        */
        .auth-header {
            text-align: center;
            padding: 40px 0;
        }

        .auth-header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 42px;
            color: var(--neon-gold);
            letter-spacing: 5px;
            text-shadow: 0 0 20px rgba(243, 186, 47, 0.4);
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-input {
            width: 100%;
            background: #111;
            border: 1px solid #333;
            padding: 18px;
            border-radius: 15px;
            color: #fff;
            font-size: 16px;
            font-family: 'Rajdhani';
            transition: 0.3s;
        }

        .form-input:focus {
            border-color: var(--neon-gold);
            background: #161616;
            box-shadow: 0 0 15px rgba(243, 186, 47, 0.1);
        }

        .action-btn {
            width: 100%;
            padding: 18px;
            border-radius: 15px;
            border: none;
            font-family: 'Orbitron';
            font-weight: 800;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        .btn-gold {
            background: linear-gradient(45deg, var(--gold-dark), var(--neon-gold));
            color: #000;
        }

        .btn-gold:active { transform: scale(0.95); }

        /* ========================================
           6. WALLET & DASHBOARD STYLES
           ========================================
        */
        .wallet-container {
            background: linear-gradient(135deg, #1a1c1e 0%, #050505 100%);
            padding: 30px;
            border-radius: 30px;
            border: 1px solid #222;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }

        .wallet-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(243,186,47,0.05) 0%, transparent 70%);
        }

        .balance-label {
            font-size: 14px;
            color: var(--text-gray);
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .balance-amount {
            font-family: 'Orbitron';
            font-size: 38px;
            color: var(--win-green);
            font-weight: 900;
        }

        .wallet-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        .mini-btn {
            padding: 12px;
            border-radius: 10px;
            font-family: 'Orbitron';
            font-size: 12px;
            border: none;
            cursor: pointer;
        }

        /* ========================================
           7. TIMER & PERIOD STYLES
           ========================================
        */
        .game-status-bar {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .status-card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 18px;
            border: 1px solid #222;
            text-align: center;
        }

        .period-id { font-family: 'Roboto Mono'; font-weight: bold; color: var(--pure-white); }
        .timer-countdown { font-family: 'Orbitron'; font-size: 28px; color: var(--neon-gold); font-weight: 700; }

        /* ========================================
           8. BETTING ENGINE UI
           ========================================
        */
        .bet-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 10px;
        }

        .bet-box {
            height: 150px;
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
            position: relative;
        }

        .bet-big { background: linear-gradient(135deg, #7b1fa2, #4a148c); border-bottom: 6px solid #310d5e; }
        .bet-small { background: linear-gradient(135deg, #00897b, #004d40); border-bottom: 6px solid #002d26; }
        
        .bet-box h2 { font-family: 'Orbitron'; font-size: 32px; margin-bottom: 5px; }
        .bet-box span { font-size: 12px; opacity: 0.7; }

        /* ========================================
           9. HISTORY & TABLES
           ========================================
        */
        .tab-container {
            margin-top: 30px;
        }

        .tab-header {
            display: flex;
            background: #111;
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 15px;
        }

        .tab-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: 0.3s;
        }

        .tab-item.active {
            background: var(--neon-gold);
            color: #000;
            font-weight: bold;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: center;
            color: #444;
            font-size: 12px;
            padding: 10px;
            border-bottom: 1px solid #222;
        }

        .data-table td {
            padding: 15px 5px;
            text-align: center;
            font-family: 'Roboto Mono';
            font-size: 14px;
            border-bottom: 1px solid #111;
        }

        /* ========================================
           10. DEPOSIT & QR SYSTEM
           ========================================
        */
        .qr-wrapper {
            background: #fff;
            padding: 15px;
            border-radius: 20px;
            width: 220px;
            margin: 20px auto;
        }

        .qr-wrapper img { width: 100%; height: auto; display: block; }

        .instruction-box {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 12px;
            font-size: 13px;
            color: var(--text-gray);
            margin-bottom: 20px;
        }

        /* ========================================
           11. ADMIN DASHBOARD STYLES
           ========================================
        */
        .admin-view {
            padding: 20px;
            background: #080808;
        }

        .admin-card {
            background: #111;
            border: 1px solid #333;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .admin-label { color: var(--neon-gold); font-size: 12px; margin-bottom: 10px; display: block; }

        .user-list-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #222;
            font-size: 12px;
        }

        /* ========================================
           12. NOTIFICATION & POPUP
           ========================================
        */
        .toast {
            position: fixed;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--neon-gold);
            color: #000;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 900;
            z-index: 10000;
            transition: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

    </style>
</head>
<body>

    <div id="toast" class="toast">WELCOME TO YGWIN</div>

    <div class="app-shell">
        
        <div id="viewRegister" class="view active">
            <div class="auth-header">
                <h1>YGWIN</h1>
                <p>Global Prediction Network</p>
            </div>
            <div class="form-group">
                <input type="number" id="regPhone" class="form-input" placeholder="Mobile Number">
            </div>
            <div class="form-group">
                <input type="password" id="regPass" class="form-input" placeholder="Create Password">
            </div>
            <div class="form-group">
                <input type="password" id="regConfirm" class="form-input" placeholder="Confirm Password">
            </div>
            <button class="action-btn btn-gold" onclick="Logic.handleRegister()">Create Account</button>
            <p style="text-align: center; margin-top: 20px; color: #666;">
                Already a member? <span style="color: var(--neon-gold); cursor: pointer;" onclick="Router.go('viewLogin')">Login Now</span>
            </p>
        </div>

        <div id="viewLogin" class="view">
            <div class="auth-header">
                <h1>YGWIN</h1>
                <p>Secure Login</p>
            </div>
            <div class="form-group">
                <input type="number" id="loginPhone" class="form-input" placeholder="Phone Number">
            </div>
            <div class="form-group">
                <input type="password" id="loginPass" class="form-input" placeholder="Password">
            </div>
            <button class="action-btn btn-gold" onclick="Logic.handleLogin()">Login to Game</button>
            <p style="text-align: center; margin-top: 20px; color: #666;">
                New here? <span style="color: var(--neon-gold); cursor: pointer;" onclick="Router.go('viewRegister')">Register</span>
            </p>
            <div onclick="Logic.adminEntry()" style="margin-top: 100px; text-align: center; color: #111;">ADMIN</div>
        </div>

        <div id="viewGame" class="view">
            <div class="wallet-container">
                <div class="balance-label">TOTAL ASSETS</div>
                <div class="balance-amount">â‚¹<span id="displayBalance">0.00</span></div>
                <div class="wallet-actions">
                    <button class="mini-btn" style="background: var(--loss-red); color: #fff;" onclick="Router.go('viewDeposit')">DEPOSIT</button>
                    <button class="mini-btn" style="background: var(--btn-yellow); color: #000;" onclick="Router.go('viewWithdraw')">WITHDRAW</button>
                </div>
            </div>

            <div class="game-status-bar">
                <div class="status-card">
                    <div class="balance-label" style="font-size: 10px;">PERIOD ID</div>
                    <div id="displayPeriod" class="period-id">202400000000</div>
                </div>
                <div class="status-card" style="border-bottom-color: var(--win-green);">
                    <div class="balance-label" style="font-size: 10px;">TIME LEFT</div>
                    <div id="displayTimer" class="timer-countdown">00:00</div>
                </div>
            </div>

            <div class="bet-area">
                <div class="bet-box bet-big" onclick="Logic.prepareBet('Big')">
                    <h2>BIG</h2>
                    <span>1:1.96 Payout</span>
                </div>
                <div class="bet-box bet-small" onclick="Logic.prepareBet('Small')">
                    <h2>SMALL</h2>
                    <span>1:1.96 Payout</span>
                </div>
            </div>

            <div class="tab-container">
                <div class="tab-header">
                    <div class="tab-item active" onclick="Logic.switchTab('gameHistory')">Game History</div>
                    <div class="tab-item" onclick="Logic.switchTab('myBets')">My Bets</div>
                </div>
                <div id="historyTableWrapper">
                    <table class="data-table">
                        <thead>
                            <tr><th>Period</th><th>Result</th><th>Size</th></tr>
                        </thead>
                        <tbody id="historyList"></tbody>
                    </table>
                </div>
            </div>
            
            <button class="action-btn btn-outline" style="color: #ff3355; border: 1px solid #ff3355; margin-top: 50px;" onclick="Logic.logout()">Logout</button>
        </div>

        <div id="viewDeposit" class="view">
            <h2 class="gold-glow">RECHARGE</h2>
            <div class="qr-wrapper">
                <img id="adminQR" src="" alt="Scan QR">
            </div>
            <div class="instruction-box">
                1. Scan QR Code & Pay.<br>
                2. Enter Amount & 12 Digit UTR.<br>
                3. Amount will be added after manual verification.
            </div>
            <input type="number" id="depAmount" class="form-input" placeholder="Enter Amount (Min â‚¹10)">
            <input type="number" id="depUTR" class="form-input" placeholder="12 Digit UTR Number">
            <button class="action-btn btn-gold" onclick="Logic.submitDeposit()">Request Deposit</button>
            <button class="action-btn btn-outline" style="border: 1px solid #333; color: #888;" onclick="Router.go('viewGame')">Cancel</button>
        </div>

        <div id="viewWithdraw" class="view">
            <h2 class="gold-glow">WITHDRAWAL</h2>
            <div class="instruction-box" style="border-left: 4px solid var(--btn-yellow);">
                Minimum withdrawal â‚¹100. Verification takes up to 24 hours.
            </div>
            <input type="text" id="witName" class="form-input" placeholder="Receiver Full Name">
            <input type="text" id="witUPI" class="form-input" placeholder="UPI Address (VPA)">
            <input type="number" id="witAmount" class="form-input" placeholder="Amount to Withdraw">
            <button class="action-btn btn-gold" onclick="Logic.submitWithdraw()">Submit Request</button>
            <button class="action-btn btn-outline" style="border: 1px solid #333; color: #888;" onclick="Router.go('viewGame')">Back</button>
        </div>

        <div id="viewAdmin" class="view admin-view" style="max-width: 100%;">
            <h1 style="font-size: 24px;">YGWIN COMMAND CENTER</h1>
            
            <div class="admin-card">
                <span class="admin-label">RESULT CONTROL (NEXT PERIOD)</span>
                <select id="manualResult" class="form-input">
                    <option value="auto">SYSTEM AUTO (RANDOM)</option>
                    <option value="Big">FORCE BIG</option>
                    <option value="Small">FORCE SMALL</option>
                </select>
            </div>

            <div class="admin-card">
                <span class="admin-label">GLOBAL QR MANAGEMENT</span>
                <input type="text" id="qrInput" class="form-input" placeholder="Image URL for QR Code">
                <button class="action-btn btn-gold" style="padding: 10px;" onclick="Logic.updateQR()">Update QR</button>
            </div>

            <div class="admin-card">
                <span class="admin-label">DEPOSIT REQUESTS</span>
                <div id="adminDepositList"></div>
            </div>

            <div class="admin-card">
                <span class="admin-label">WITHDRAWAL REQUESTS</span>
                <div id="adminWithdrawList"></div>
            </div>

            <div class="admin-card">
                <span class="admin-label">USER ACCOUNTS</span>
                <div id="adminUserList"></div>
            </div>

            <button class="action-btn" style="background: #333; color: #fff;" onclick="location.reload()">Exit Admin</button>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, set, get, onValue, update, push, serverTimestamp, query, limitToLast, onChildAdded } 
        from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

        // CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyBBlKPL2V0JKCYN_GBGGSqDBZr7kFNiKZc",
            authDomain: "beast-web-cff81.firebaseapp.com",
            databaseURL: "https://beast-web-cff81-default-rtdb.firebaseio.com",
            projectId: "beast-web-cff81",
            storageBucket: "beast-web-cff81.firebasestorage.app",
            messagingSenderId: "457850837406",
            appId: "1:457850837406:web:32263b2b15fb8705ddde8f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- SOUND ENGINE ---
        const Sounds = {
            play: (type) => {
                const audio = new Audio();
                if(type === 'win') audio.src = 'https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3';
                if(type === 'loss') audio.src = 'https://www.soundjay.com/buttons/sounds/button-10.mp3';
                if(type === 'click') audio.src = 'https://www.soundjay.com/buttons/sounds/button-16.mp3';
                audio.play().catch(() => {});
            }
        };

        // --- ROUTING ENGINE ---
        window.Router = {
            go: (viewId) => {
                Sounds.play('click');
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.getElementById(viewId).classList.add('active');
                window.scrollTo(0,0);
            }
        };

        // --- UTILS ---
        window.Utils = {
            notify: (msg) => {
                const t = document.getElementById('toast');
                t.innerText = msg;
                t.style.top = '30px';
                setTimeout(() => { t.style.top = '-100px'; }, 3000);
            }
        };

        // --- MAIN LOGIC ENGINE ---
        window.Logic = {
            user: null,
            timerId: null,
            currentPeriod: null,
            processing: false,

            /* Registration Logic */
            handleRegister: async () => {
                const phone = document.getElementById('regPhone').value.trim();
                const pass = document.getElementById('regPass').value.trim();
                const conf = document.getElementById('regConfirm').value.trim();

                if(!phone || phone.length < 10) return Utils.notify("âŒ Invalid Phone Number!");
                if(pass.length < 4) return Utils.notify("âŒ Password too short!");
                if(pass !== conf) return Utils.notify("âŒ Passwords do not match!");

                const uRef = ref(db, `users/${phone}`);
                const snap = await get(uRef);
                
                if(snap.exists()) {
                    Utils.notify("âš ï¸ Number already registered!");
                } else {
                    await set(uRef, { phone, pass, balance: 0, created: Date.now() });
                    Utils.notify("âœ… Account Created Successfully!");
                    Router.go('viewLogin');
                }
            },

            /* Login Logic */
            handleLogin: async () => {
                const phone = document.getElementById('loginPhone').value.trim();
                const pass = document.getElementById('loginPass').value.trim();

                const snap = await get(ref(db, `users/${phone}`));
                if(!snap.exists()) return Utils.notify("âŒ Number not found!");
                if(snap.val().pass !== pass) return Utils.notify("âŒ Incorrect Password!");

                localStorage.setItem('ygwin_session', phone);
                Logic.initApp();
            },

            /* App Initialization */
            initApp: () => {
                const phone = localStorage.getItem('ygwin_session');
                if(!phone) return Router.go('viewLogin');

                // Sync Balance
                onValue(ref(db, `users/${phone}`), (s) => {
                    if(s.exists()) {
                        Logic.user = s.val();
                        document.getElementById('displayBalance').innerText = parseFloat(s.val().balance).toFixed(2);
                    }
                });

                // Sync Admin Configs (QR etc)
                onValue(ref(db, 'admin/config'), (s) => {
                    const data = s.val();
                    if(data && data.qr_url) document.getElementById('adminQR').src = data.qr_url;
                });

                Logic.startMasterClock();
                Logic.syncGameHistory();
                Router.go('viewGame');
            },

            /* 1-Minute Period & Timer Logic (Java Port) */
            startMasterClock: () => {
                if(Logic.timerId) clearInterval(Logic.timerId);
                
                Logic.timerId = setInterval(() => {
                    const now = new Date();
                    const ist = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Kolkata"}));
                    
                    const seconds = ist.getSeconds();
                    const remain = 60 - seconds;
                    const minutes = ist.getMinutes();
                    const totalMins = ist.getHours() * 60 + minutes;
                    
                    // Period ID Generation (YYYYMMDD + Index)
                    const dateStr = ist.toISOString().slice(0,10).replace(/-/g, "");
                    const pId = dateStr + (10001 + totalMins).toString();
                    
                    document.getElementById('displayPeriod').innerText = pId;
                    document.getElementById('displayTimer').innerText = `00:${remain < 10 ? '0'+remain : remain}`;
                    
                    Logic.currentPeriod = pId;

                    // Execute Settle at 00
                    if(remain === 60 && !Logic.processing) {
                        Logic.processing = true;
                        Logic.generateGlobalResult(pId);
                    }
                    if(remain < 55) Logic.processing = false;
                }, 1000);
            },

            /* Result Generation System */
            generateGlobalResult: async (periodId) => {
                const prevPeriod = (parseInt(periodId) - 1).toString();
                
                // Get Admin Override
                const ctrlSnap = await get(ref(db, 'admin/control/nextResult'));
                const mode = ctrlSnap.val() || 'auto';
                
                let finalRes = mode === 'auto' ? (Math.random() > 0.5 ? 'Big' : 'Small') : mode;
                
                // Push to Global History
                await set(ref(db, `history/${prevPeriod}`), {
                    period: prevPeriod,
                    result: finalRes,
                    timestamp: Date.now()
                });

                // Reset Admin Control
                await set(ref(db, 'admin/control/nextResult'), 'auto');
                
                // Trigger Individual Settlement
                Logic.settleMyBets(prevPeriod, finalRes);
            },

            /* Betting Logic */
            prepareBet: async (type) => {
                const phone = localStorage.getItem('ygwin_session');
                const amt = prompt(`[YGWIN] Bet on ${type.toUpperCase()}\nEnter Amount:`, "10");
                
                if(!amt || isNaN(amt) || amt < 1) return;
                
                const uRef = ref(db, `users/${phone}`);
                const uSnap = await get(uRef);
                const currentBal = uSnap.val().balance;

                if(currentBal < amt) {
                    Utils.notify("âš ï¸ Insufficient Balance! Recharge first.");
                    return Router.go('viewDeposit');
                }

                // Deduct Balance
                await update(uRef, { balance: currentBal - parseInt(amt) });
                
                // Log Bet to DB
                await set(ref(db, `bets/${Logic.currentPeriod}/${phone}/${Date.now()}`), {
                    type: type,
                    amount: parseInt(amt),
                    status: 'pending'
                });

                Utils.notify(`âœ… â‚¹${amt} Bet on ${type} Locked!`);
            },

            /* Settlement Logic */
            settleMyBets: async (period, result) => {
                const phone = localStorage.getItem('ygwin_session');
                const betsRef = ref(db, `bets/${period}/${phone}`);
                const bSnap = await get(betsRef);

                if(bSnap.exists()) {
                    let totalWin = 0;
                    bSnap.forEach(child => {
                        const bet = child.val();
                        if(bet.type === result) {
                            totalWin += bet.amount * 1.96;
                        }
                    });

                    if(totalWin > 0) {
                        const uRef = ref(db, `users/${phone}`);
                        const uSnap = await get(uRef);
                        await update(uRef, { balance: uSnap.val().balance + totalWin });
                        Sounds.play('win');
                        alert(`ðŸŽŠ CONGRATULATIONS! ðŸŽŠ\nPeriod: ${period}\nResult: ${result}\nCredit: â‚¹${totalWin.toFixed(2)}`);
                    } else {
                        Sounds.play('loss');
                        alert(`ðŸ’” HARD LUCK!\nPeriod: ${period}\nResult: ${result}\nBetter luck next time!`);
                    }
                }
            },

            /* History Sync */
            syncGameHistory: () => {
                const hRef = query(ref(db, 'history'), limitToLast(10));
                onValue(hRef, (s) => {
                    const tbody = document.getElementById('historyList');
                    tbody.innerHTML = "";
                    const data = s.val();
                    if(data) {
                        Object.keys(data).reverse().forEach(key => {
                            const item = data[key];
                            const color = item.result === 'Big' ? '#a020f0' : '#00ff88';
                            tbody.innerHTML += `
                                <tr>
                                    <td>${item.period}</td>
                                    <td style="color: ${color}">${item.result}</td>
                                    <td><span style="background:${color}; color:#000; padding:2px 8px; border-radius:4px;">${item.result[0]}</span></td>
                                </tr>
                            `;
                        });
                    }
                });
            },

            /* Deposit System */
            submitDeposit: async () => {
                const amt = document.getElementById('depAmount').value;
                const utr = document.getElementById('depUTR').value;
                const phone = localStorage.getItem('ygwin_session');

                if(amt < 10) return Utils.notify("âŒ Min Deposit â‚¹10");
                if(utr.length !== 12) return Utils.notify("âŒ Invalid UTR!");

                await push(ref(db, 'requests/deposits'), {
                    phone, amount: parseInt(amt), utr, status: 'pending', time: serverTimestamp()
                });
                
                alert("Please Wait Patiently. Your amount will be added after checking payment.");
                Router.go('viewGame');
            },

            /* Withdrawal System */
            submitWithdraw: async () => {
                const amt = document.getElementById('witAmount').value;
                const upi = document.getElementById('witUPI').value;
                const name = document.getElementById('witName').value;
                const phone = localStorage.getItem('ygwin_session');

                if(amt < 100) return Utils.notify("âŒ Min Withdrawal â‚¹100");
                if(amt > Logic.user.balance) return Utils.notify("âŒ Insufficient Balance!");

                await push(ref(db, 'requests/withdrawals'), {
                    phone, amount: parseInt(amt), upi, name, status: 'pending', time: serverTimestamp()
                });

                // Deduct balance instantly
                await update(ref(db, `users/${phone}`), { balance: Logic.user.balance - parseInt(amt) });
                Utils.notify("âœ… Withdrawal Request Sent!");
                Router.go('viewGame');
            },

            /* Admin Logic */
            adminEntry: () => {
                const key = prompt("Enter YG-SECRET-KEY:");
                if(key === "myselfyg26") {
                    Router.go('viewAdmin');
                    Logic.initAdminDashboard();
                } else {
                    Utils.notify("âŒ Unauthorized Access!");
                }
            },

            initAdminDashboard: () => {
                // Set Result Manual
                document.getElementById('manualResult').onchange = (e) => {
                    set(ref(db, 'admin/control/nextResult'), e.target.value);
                    Utils.notify("Target Result Set to: " + e.target.value);
                };

                // Deposit Approval Stream
                onValue(ref(db, 'requests/deposits'), (s) => {
                    const list = document.getElementById('adminDepositList');
                    list.innerHTML = "";
                    s.forEach(child => {
                        const d = child.val();
                        if(d.status === 'pending') {
                            list.innerHTML += `
                                <div class="admin-item" style="background:#1a1a1a; padding:10px; margin-bottom:5px; border-radius:8px;">
                                    ${d.phone} | â‚¹${d.amount} | UTR: ${d.utr}
                                    <div style="margin-top:5px;">
                                        <button onclick="Logic.approveDep('${child.key}','${d.phone}',${d.amount})" style="background:green; color:#fff; border:none; padding:5px 10px; border-radius:5px;">Approve</button>
                                        <button onclick="Logic.rejectDep('${child.key}')" style="background:red; color:#fff; border:none; padding:5px 10px; border-radius:5px; margin-left:10px;">Reject</button>
                                    </div>
                                </div>
                            `;
                        }
                    });
                });

                // Withdraw Approval Stream
                onValue(ref(db, 'requests/withdrawals'), (s) => {
                    const list = document.getElementById('adminWithdrawList');
                    list.innerHTML = "";
                    s.forEach(child => {
                        const w = child.val();
                        if(w.status === 'pending') {
                            list.innerHTML += `
                                <div class="admin-item" style="background:#1a1a1a; padding:10px; margin-bottom:5px; border-radius:8px;">
                                    ${w.phone} | â‚¹${w.amount} | ${w.upi}
                                    <div style="margin-top:5px;">
                                        <button onclick="Logic.approveWit('${child.key}')" style="background:green; color:#fff; border:none; padding:5px 10px; border-radius:5px;">Approve</button>
                                        <button onclick="Logic.rejectWit('${child.key}','${w.phone}',${w.amount})" style="background:red; color:#fff; border:none; padding:5px 10px; border-radius:5px; margin-left:10px;">Reject</button>
                                    </div>
                                </div>
                            `;
                        }
                    });
                });

                // User Management Stream
                onValue(ref(db, 'users'), (s) => {
                    const list = document.getElementById('adminUserList');
                    list.innerHTML = "";
                    s.forEach(u => {
                        list.innerHTML += `<div class="user-list-item"><span>${u.val().phone}</span><span>P: ${u.val().pass}</span><span>â‚¹${u.val().balance}</span></div>`;
                    });
                });
            },

            updateQR: () => {
                const url = document.getElementById('qrInput').value;
                if(!url) return;
                update(ref(db, 'admin/config'), { qr_url: url });
                Utils.notify("QR Code Updated Globally!");
            },

            approveDep: async (key, phone, amt) => {
                const uRef = ref(db, `users/${phone}`);
                const uSnap = await get(uRef);
                await update(uRef, { balance: (uSnap.val().balance || 0) + amt });
                await update(ref(db, `requests/deposits/${key}`), { status: 'approved' });
                Utils.notify("Approved Deposit for " + phone);
            },

            rejectDep: async (key) => {
                await update(ref(db, `requests/deposits/${key}`), { status: 'rejected' });
            },

            approveWit: async (key) => {
                await update(ref(db, `requests/withdrawals/${key}`), { status: 'approved' });
                Utils.notify("Withdrawal Credited!");
            },

            rejectWit: async (key, phone, amt) => {
                const uRef = ref(db, `users/${phone}`);
                const uSnap = await get(uRef);
                await update(uRef, { balance: (uSnap.val().balance || 0) + amt });
                await update(ref(db, `requests/withdrawals/${key}`), { status: 'rejected' });
            },

            logout: () => {
                localStorage.removeItem('ygwin_session');
                location.reload();
            },

            switchTab: (tab) => {
                Utils.notify("Loading " + tab + "...");
                // Add tab switching logic here for more lines
            }
        };

        // --- BOOTSTRAP ---
        window.onload = () => {
            const session = localStorage.getItem('ygwin_session');
            if(session) {
                Logic.initApp();
            } else {
                Router.go('viewRegister');
            }
        };

    </script>
</body>
</html>
