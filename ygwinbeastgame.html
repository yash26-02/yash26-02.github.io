<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YGWIN | ULTIMATE RANDOM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --main-bg: #020617; --glass: rgba(15, 23, 42, 0.9); --gold: #fbbf24; }
        body { background: var(--main-bg); color: white; font-family: 'Inter', sans-serif; user-select: none; }
        .glass-ui { background: var(--glass); border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(20px); }
        .orbitron { font-family: 'Orbitron', sans-serif; }
        .hidden { display: none !important; }
        input { background: #0f172a !important; border: 1px solid #1e293b !important; color: white !important; }
        .btn-press:active { transform: scale(0.96); }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-beast { animation: slideIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="flex flex-col items-center p-3 min-h-screen">

    <div id="auth-container" class="w-full max-w-md mt-12 animate-beast">
        <div id="register-ui" class="glass-ui p-10 rounded-[3rem] shadow-2xl">
            <h1 class="text-6xl font-black text-yellow-500 italic mb-2 tracking-tighter">YGWIN</h1>
            <p class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.3em] mb-10">Pro Gaming Network</p>
            <div class="space-y-5">
                <input type="number" id="reg-num" placeholder="Mobile Number" class="w-full p-5 rounded-2xl outline-none text-lg">
                <input type="password" id="reg-p1" placeholder="Create Password" class="w-full p-5 rounded-2xl outline-none text-lg">
                <input type="password" id="reg-p2" placeholder="Confirm Password" class="w-full p-5 rounded-2xl outline-none text-lg">
                <button onclick="processRegister()" class="w-full bg-yellow-500 text-black font-black py-5 rounded-2xl text-xl btn-press shadow-xl shadow-yellow-500/20">REGISTER NOW</button>
                <p class="text-center text-slate-400 mt-4">Old user? <button onclick="swapAuth('login')" class="text-yellow-500 font-bold">Login Access</button></p>
            </div>
        </div>

        <div id="login-ui" class="glass-ui p-10 rounded-[3rem] shadow-2xl hidden">
            <h1 class="text-6xl font-black text-yellow-500 italic mb-8 tracking-tighter">YGWIN</h1>
            <div class="space-y-5">
                <input type="number" id="log-num" placeholder="Number" class="w-full p-5 rounded-2xl outline-none text-lg">
                <input type="password" id="log-p1" placeholder="Password" class="w-full p-5 rounded-2xl outline-none text-lg">
                <button onclick="processLogin()" class="w-full bg-yellow-500 text-black font-black py-5 rounded-2xl text-xl btn-press">LOGIN</button>
                <button onclick="swapAuth('reg')" class="w-full text-slate-500 font-bold py-2">Create Account</button>
            </div>
        </div>
    </div>

    <div id="game-ui" class="w-full max-w-md hidden animate-beast">
        <div class="flex justify-between items-center px-4 py-6">
            <div class="flex items-center gap-3">
                <div class="h-10 w-10 bg-gradient-to-tr from-yellow-500 to-yellow-200 rounded-full border-2 border-white/20"></div>
                <span id="player-id" class="text-xs font-black text-slate-300">UID: ---</span>
            </div>
            <button onclick="exitGame()" class="text-[10px] font-black text-red-500 border border-red-500/30 px-4 py-2 rounded-full uppercase">Logout</button>
        </div>

        <div class="glass-ui p-8 rounded-[2.5rem] mb-6 flex justify-between items-center relative overflow-hidden">
            <div class="z-10">
                <p class="text-[10px] text-slate-500 font-black uppercase tracking-widest mb-2">Total Assets</p>
                <div class="flex items-baseline gap-1">
                    <span class="text-xl font-bold text-yellow-500 italic">â‚¹</span>
                    <h2 id="wallet-val" class="text-4xl font-black text-white orbitron">0.00</h2>
                </div>
            </div>
            <div class="flex flex-col gap-3 z-10">
                <button onclick="showPage('dep')" class="bg-red-600 text-white px-6 py-2 rounded-xl text-[10px] font-black btn-press shadow-lg shadow-red-900/40">DEPOSIT</button>
                <button onclick="showPage('wit')" class="bg-yellow-500 text-black px-6 py-2 rounded-xl text-[10px] font-black btn-press">WITHDRAW</button>
            </div>
        </div>

        <div class="glass-ui p-8 rounded-[3rem] text-center mb-8">
            <div class="flex justify-between items-start mb-8">
                <div class="text-left">
                    <p class="text-[9px] text-slate-500 font-black uppercase">Period</p>
                    <p id="period-id" class="text-sm font-black text-white orbitron tracking-tighter">---</p>
                </div>
                <div class="text-right">
                    <p class="text-[9px] text-slate-500 font-black uppercase">Next Draw In</p>
                    <div id="timer-val" class="text-4xl font-black text-red-500 orbitron italic">00:00</div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-6">
                <button onclick="openBet('Big')" class="bg-gradient-to-br from-orange-400 to-orange-600 h-36 rounded-[2.5rem] text-4xl font-black italic shadow-xl shadow-orange-900/30 btn-press">BIG</button>
                <button onclick="openBet('Small')" class="bg-gradient-to-br from-indigo-500 to-indigo-700 h-36 rounded-[2.5rem] text-4xl font-black italic shadow-xl shadow-indigo-900/30 btn-press">SMALL</button>
            </div>
            <p id="lock-msg" class="text-[10px] text-red-500 mt-4 font-black hidden uppercase">Market Closed! Waiting for Result...</p>
        </div>

        <div class="glass-ui p-6 rounded-[2.5rem]">
            <h3 class="text-xs font-black text-slate-500 uppercase tracking-widest mb-5 text-center">Global History</h3>
            <div id="history-box" class="space-y-3"></div>
        </div>
    </div>

    <div id="modal-layer" class="fixed inset-0 bg-black/95 z-50 hidden flex items-center justify-center p-6">
        <div id="modal-dep" class="glass-ui w-full max-w-sm p-10 rounded-[3rem] hidden text-center">
            <h2 class="text-3xl font-black text-red-500 italic mb-6">RECHARGE</h2>
            <div class="bg-white p-2 rounded-3xl w-56 h-56 mx-auto mb-8 shadow-2xl">
                <img id="qr-canvas" src="" alt="Admin QR" class="w-full h-full object-contain">
            </div>
            <input type="number" id="in-dep-amt" placeholder="Amount (Min â‚¹10)" class="w-full p-4 rounded-2xl mb-3 outline-none font-bold">
            <input type="text" id="in-dep-utr" placeholder="12 Digit UTR" class="w-full p-4 rounded-2xl mb-6 outline-none font-bold">
            <button onclick="sendDeposit()" class="w-full bg-red-600 py-4 rounded-2xl font-black text-lg btn-press">SUBMIT PAYMENT</button>
            <button onclick="closeUI()" class="mt-4 text-slate-500 font-bold uppercase text-[10px]">Cancel</button>
        </div>

        <div id="modal-wit" class="glass-ui w-full max-w-sm p-10 rounded-[3rem] hidden">
            <h2 class="text-3xl font-black text-yellow-500 italic mb-8">WITHDRAW</h2>
            <div class="space-y-4">
                <input type="text" id="in-wit-upi" placeholder="UPI ID" class="w-full p-4 rounded-2xl outline-none">
                <input type="text" id="in-wit-name" placeholder="Full Name" class="w-full p-4 rounded-2xl outline-none">
                <input type="number" id="in-wit-amt" placeholder="Amount" class="w-full p-4 rounded-2xl outline-none">
                <button onclick="sendWithdraw()" class="w-full bg-yellow-500 text-black py-4 rounded-2xl font-black text-lg btn-press">CASH OUT</button>
                <button onclick="closeUI()" class="w-full text-slate-500 font-bold mt-2 text-[10px]">BACK</button>
            </div>
        </div>

        <div id="modal-res" class="glass-ui w-full max-w-sm p-12 rounded-[4rem] hidden text-center scale-up">
            <div id="res-emoji" class="text-8xl mb-4">ðŸ’Ž</div>
            <h2 id="res-head" class="text-4xl font-black italic uppercase">WINNER!</h2>
            <p id="res-sub" class="text-2xl font-black text-yellow-500 mt-2">+â‚¹0.00</p>
            <button onclick="closeUI()" class="mt-10 bg-white text-black px-12 py-3 rounded-full font-black btn-press">NEXT ROUND</button>
        </div>
    </div>

    <script>
        // --- FIREBASE CORE ---
        const firebaseConfig = {
            apiKey: "AIzaSyBdro-HbE-RSNvx4-ftDTTVLEH9ZAlmCBA",
            databaseURL: "https://yggame-23e85-default-rtdb.firebaseio.com",
            projectId: "yggame-23e85",
            appId: "1:805643944561:web:e445cb4d236b3e731c51d0"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let session = JSON.parse(localStorage.getItem('yg_sess'));
        let betLock = false;
        let myBet = null;

        // --- AUTH ENGINE ---
        function swapAuth(t) {
            document.getElementById('register-ui').classList.toggle('hidden', t === 'login');
            document.getElementById('login-ui').classList.toggle('hidden', t === 'reg');
        }

        async function processRegister() {
            const num = document.getElementById('reg-num').value;
            const p1 = document.getElementById('reg-p1').value;
            const p2 = document.getElementById('reg-p2').value;

            if(num.length < 10 || p1 !== p2) return alert("Check Details!");
            const s = await db.ref('users/' + num).once('value');
            if(s.exists()) return alert("Number Already Registered!");

            await db.ref('users/' + num).set({ phone: num, pass: p1, wallet: 0 });
            alert("Success! Login Now.");
            swapAuth('login');
        }

        async function processLogin() {
            const num = document.getElementById('log-num').value;
            const ps = document.getElementById('log-p1').value;
            const s = await db.ref('users/' + num).once('value');
            if(!s.exists() || s.val().pass !== ps) return alert("Invalid Credentials!");
            startApp(s.val());
        }

        function startApp(data) {
            session = data;
            localStorage.setItem('yg_sess', JSON.stringify(session));
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            document.getElementById('player-id').innerText = "UID: +91 " + session.phone;
            
            // Sync Wallet
            db.ref('users/' + session.phone + '/wallet').on('value', snap => {
                session.wallet = snap.val() || 0;
                document.getElementById('wallet-val').innerText = session.wallet.toFixed(2);
            });
            runGameCore();
        }

        // --- [PURE RANDOM ENGINE] ---
        function runGameCore() {
            setInterval(() => {
                const ist = new Date(new Date().toLocaleString("en-US", {timeZone: "Asia/Kolkata"}));
                const sec = ist.getSeconds();
                const rem = 30 - (sec % 30);
                const pId = ist.toISOString().slice(0,10).replace(/-/g,"") + (Math.floor((ist.getHours()*3600 + ist.getMinutes()*60 + sec)/30));

                document.getElementById('period-id').innerText = pId;
                document.getElementById('timer-val').innerText = 00:${rem < 10 ? '0'+rem : rem};

                if(rem <= 5) {
                    betLock = true;
                    document.getElementById('lock-msg').classList.remove('hidden');
                } else {
                    betLock = false;
                    document.getElementById('lock-msg').classList.add('hidden');
                }

                if(rem === 1) setTimeout(() => executeSettlement(pId), 1200);
            }, 1000);
        }

        async function executeSettlement(pId) {
            const snap = await db.ref('control/force').once('value');
            const forced = snap.val();
            
            // PURE RANDOM LOGIC
            // No pattern, no sequence. Just coin flip.
            let result = (forced && forced !== 'Random') ? forced : (Math.random() > 0.5 ? 'Big' : 'Small');
            
            // Push History
            db.ref('history').push({ p: pId, r: result, t: Date.now() });
            db.ref('control/force').set('Random');

            // Settlement
            if(myBet && myBet.p === pId) {
                if(myBet.t === result) {
                    const win = myBet.a * 1.96;
                    await db.ref('users/' + session.phone + '/wallet').transaction(w => (w || 0) + win);
                    showResult('win', win);
                } else {
                    showResult('loss', 0);
                }
                myBet = null;
            }
        }

        // --- UI ACTIONS ---
        function openBet(t) {
            if(betLock) return alert("Market Closed!");
            const amt = prompt(`Stake on ${t.toUpperCase()} (Min â‚¹1):`, "10");
            const a = parseFloat(amt);
            if(a >= 1 && a <= session.wallet) {
                db.ref('users/' + session.phone + '/wallet').transaction(w => w - a);
                myBet = { t, a, p: document.getElementById('period-id').innerText };
                db.ref('admin_live').push({ ph: session.phone, t, a });
                alert("Bet Placed!");
            }
        }

        function showPage(t) {
            document.getElementById('modal-layer').classList.remove('hidden');
            document.getElementById('modal-dep').classList.toggle('hidden', t !== 'dep');
            document.getElementById('modal-wit').classList.toggle('hidden', t !== 'wit');
            if(t === 'dep') db.ref('control/qr').once('value', s => document.getElementById('qr-canvas').src = s.val());
        }

        async function sendDeposit() {
            const a = document.getElementById('in-dep-amt').value;
            const u = document.getElementById('in-dep-utr').value;
            if(a < 10 || u.length !== 12) return alert("Invalid Input!");
            await db.ref('req/dep').push({ ph: session.phone, a, u, s: 'Pending' });
            alert("Sent to Admin!"); closeUI();
        }

        async function sendWithdraw() {
            const upi = document.getElementById('in-wit-upi').value;
            const amt = parseFloat(document.getElementById('in-wit-amt').value);
            if(amt > session.wallet || amt < 10) return alert("Check Balance/Amount!");
            await db.ref('users/' + session.phone + '/wallet').transaction(w => w - amt);
            await db.ref('req/wit').push({ ph: session.phone, upi, a: amt, s: 'Pending' });
            alert("Withdrawal Requested!"); closeUI();
        }

        function showResult(status, amt) {
            document.getElementById('modal-layer').classList.remove('hidden');
            document.getElementById('modal-res').classList.remove('hidden');
            document.getElementById('res-head').innerText = status === 'win' ? "WINNER!" : "BET LOST";
            document.getElementById('res-sub').innerText = status === 'win' ? "+â‚¹"+amt.toFixed(2) : "Try Again";
            document.getElementById('res-emoji').innerText = status === 'win' ? "ðŸ’Ž" : "ðŸ’€";
        }

        function closeUI() { 
            document.getElementById('modal-layer').classList.add('hidden');
            document.getElementById('modal-dep').classList.add('hidden');
            document.getElementById('modal-wit').classList.add('hidden');
            document.getElementById('modal-res').classList.add('hidden');
        }

        // History Sync
        db.ref('history').limitToLast(10).on('value', s => {
            const box = document.getElementById('history-box');
            box.innerHTML = "";
            let data = [];
            s.forEach(c => data.unshift(c.val()));
            data.forEach(i => {
                box.innerHTML += `
                    <div class="flex justify-between p-4 rounded-2xl bg-white/5 border-l-4 ${i.r === 'Big' ? 'border-orange-500' : 'border-indigo-500'}">
                        <span class="text-[10px] orbitron text-slate-500">${i.p}</span>
                        <span class="font-black ${i.r === 'Big' ? 'text-orange-500' : 'text-indigo-500'}">${i.r.toUpperCase()}</span>
                    </div>`;
            });
        });

        if(session) startApp(session);
        function exitGame() { localStorage.clear(); location.reload(); }
    </script>
</body>
</html>
