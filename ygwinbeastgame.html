<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>YGWIN | BEAST GAME</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* CSS VARIABLES FOR THEME */
        :root {
            --bg-deep: #020617;
            --glass-white: rgba(255, 255, 255, 0.03);
            --gold: #f59e0b;
            --red-glow: #ef4444;
            --indigo-glow: #6366f1;
        }

        /* RESET & BASE STYLES */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            background-color: var(--bg-deep);
            background-image: radial-gradient(circle at top, #1e1b4b, transparent);
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
        }

        .orbitron { font-family: 'Orbitron', sans-serif; }

        /* ADVANCED ANIMATIONS */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards; }

        @keyframes pulseGlow { 
            0%, 100% { box-shadow: 0 0 10px rgba(245, 158, 11, 0.2); }
            50% { box-shadow: 0 0 30px rgba(245, 158, 11, 0.5); }
        }
        .glow-gold { animation: pulseGlow 2s infinite; }

        /* UI COMPONENTS */
        .glass-panel {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 2.5rem;
        }

        .btn-beast {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 900;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }
        .btn-beast:active { transform: scale(0.94); filter: brightness(1.2); }

        /* CUSTOM INPUTS */
        input {
            background: #0f172a !important;
            border: 1px solid #1e293b !important;
            color: white !important;
            transition: 0.3s;
        }
        input:focus { border-color: var(--gold) !important; outline: none; }

        /* TAB SYSTEM */
        .tab-btn { color: #64748b; font-weight: 700; border-bottom: 3px solid transparent; padding-bottom: 4px; }
        .tab-btn.active { color: var(--gold); border-color: var(--gold); }

        .hidden { display: none !important; }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
    </style>
</head>
<body class="p-4 flex flex-col items-center">

    <div id="loader" class="fixed inset-0 bg-slate-950 z-[100] flex flex-col items-center justify-center transition-all duration-700">
        <h1 class="text-5xl font-black text-yellow-500 orbitron italic animate-bounce">YGWIN</h1>
        <div class="w-48 h-1 bg-slate-800 rounded-full mt-4 overflow-hidden">
            <div class="h-full bg-yellow-500 animate-[loading_2s_infinite]"></div>
        </div>
    </div>
    <style> @keyframes loading { from { transform: translateX(-100%); } to { transform: translateX(100%); } } </style>

    <div id="auth-layer" class="w-full max-w-md mt-10 space-y-8 hidden">
        <div id="reg-box" class="glass-panel p-10 animate-fade">
            <h2 class="text-4xl font-black text-white italic mb-1 tracking-tighter">REGISTER</h2>
            <p class="text-slate-500 text-[10px] uppercase font-bold tracking-widest mb-10 border-l-4 border-yellow-500 pl-2">Create Titan Identity</p>
            
            <div class="space-y-4">
                <div class="group">
                    <label class="text-[10px] text-slate-500 font-bold ml-2">MOBILE NUMBER</label>
                    <input type="number" id="reg-phone" class="w-full p-4 rounded-2xl mt-1 text-lg" placeholder="Enter 10 Digits">
                </div>
                <div>
                    <label class="text-[10px] text-slate-500 font-bold ml-2">SECRET PASSWORD</label>
                    <input type="password" id="reg-pass" class="w-full p-4 rounded-2xl mt-1" placeholder="Minimum 6 characters">
                </div>
                <div>
                    <label class="text-[10px] text-slate-500 font-bold ml-2">CONFIRM SECRET</label>
                    <input type="password" id="reg-cpass" class="w-full p-4 rounded-2xl mt-1" placeholder="Repeat password">
                </div>
                <button onclick="handleRegister()" class="w-full bg-yellow-500 text-black py-5 rounded-2xl btn-beast text-xl shadow-lg mt-4">Initialize Account</button>
                <p class="text-center text-slate-400 mt-6 text-sm">Already a Warrior? <button onclick="switchAuth('login')" class="text-yellow-500 font-black">LOGIN</button></p>
            </div>
        </div>

        <div id="log-box" class="glass-panel p-10 hidden animate-fade">
            <h2 class="text-4xl font-black text-white italic mb-1 tracking-tighter">LOGIN</h2>
            <p class="text-slate-500 text-[10px] uppercase font-bold tracking-widest mb-10 border-l-4 border-yellow-500 pl-2">Access Secure Vault</p>
            <div class="space-y-5">
                <input type="number" id="log-phone" class="w-full p-4 rounded-2xl" placeholder="Registered Number">
                <input type="password" id="log-pass" class="w-full p-4 rounded-2xl" placeholder="Password">
                <button onclick="handleLogin()" class="w-full bg-yellow-500 text-black py-5 rounded-2xl btn-beast text-xl">Enter Battleground</button>
                <p class="text-center text-slate-400 mt-6 text-sm">New Recruit? <button onclick="switchAuth('reg')" class="text-yellow-500 font-black">SIGN UP</button></p>
            </div>
        </div>
    </div>

    <div id="game-layer" class="w-full max-w-md hidden animate-fade">
        
        <div class="flex justify-between items-center py-6 px-2">
            <div class="flex items-center gap-3">
                <div class="w-14 h-14 bg-gradient-to-tr from-yellow-600 to-yellow-300 rounded-3xl flex items-center justify-center shadow-xl rotate-3">
                    <span class="text-black font-black text-2xl orbitron">YG</span>
                </div>
                <div>
                    <h4 id="user-display" class="font-black text-sm tracking-widest">USER_0000</h4>
                    <span class="text-[9px] bg-green-500/20 text-green-400 px-2 py-0.5 rounded-full font-bold uppercase">Level 1 Titan</span>
                </div>
            </div>
            <button onclick="logout()" class="p-3 bg-red-500/10 rounded-2xl border border-red-500/20"><img src="https://img.icons8.com/ios-glyphs/30/fa314a/logout-rounded--v1.png" class="w-5 h-5"/></button>
        </div>

        <div class="glass-panel p-8 mb-6 bg-gradient-to-br from-slate-900 to-slate-950 relative overflow-hidden border-b-4 border-yellow-500/30">
            <div class="relative z-10 flex justify-between items-center">
                <div>
                    <p class="text-[10px] text-slate-500 font-black uppercase mb-1">Available Credits</p>
                    <div class="flex items-baseline gap-2">
                        <span class="text-2xl font-bold text-yellow-500">â‚¹</span>
                        <h2 id="balance-txt" class="text-5xl font-black orbitron tracking-tighter">0.00</h2>
                    </div>
                </div>
                <div class="flex flex-col gap-3">
                    <button onclick="openModal('dep')" class="bg-red-600 px-8 py-3 rounded-2xl text-[10px] font-black btn-beast shadow-lg shadow-red-900/40">DEPOSIT</button>
                    <button onclick="openModal('wit')" class="bg-yellow-500 text-black px-8 py-3 rounded-2xl text-[10px] font-black btn-beast">WITHDRAW</button>
                </div>
            </div>
            <div class="absolute top-0 right-0 w-32 h-32 bg-yellow-500/5 blur-3xl rounded-full"></div>
        </div>

        <div class="glass-panel p-10 mb-6 text-center border-t border-white/5">
            <div class="flex justify-between items-center mb-8">
                <div class="text-left">
                    <p class="text-[10px] text-slate-500 font-bold uppercase">Market Period</p>
                    <h5 id="period-id" class="text-sm font-black orbitron tracking-tight text-yellow-500">----</h5>
                </div>
                <div class="text-right">
                    <p class="text-[10px] text-slate-500 font-bold uppercase">Lock In Time</p>
                    <h3 id="timer-clock" class="text-5xl font-black orbitron text-red-500 italic tracking-tighter">00:00</h3>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-6">
                <button onclick="bet('Big')" id="big-btn" class="bg-gradient-to-b from-orange-500 to-orange-700 h-40 rounded-[2.5rem] text-4xl font-black border-b-8 border-orange-900 shadow-2xl btn-beast">BIG</button>
                <button onclick="bet('Small')" id="small-btn" class="bg-gradient-to-b from-indigo-500 to-indigo-700 h-40 rounded-[2.5rem] text-4xl font-black border-b-8 border-indigo-950 shadow-2xl btn-beast">SMALL</button>
            </div>
            <p class="mt-6 text-[8px] text-slate-600 font-black tracking-[0.4em] uppercase">1:1.96 High Probability Returns</p>
        </div>

        <div class="glass-panel p-6">
            <div class="flex gap-6 mb-6 px-2">
                <button id="tab-game" onclick="switchTab('game')" class="tab-btn active">Game History</button>
                <button id="tab-my" onclick="switchTab('my')" class="tab-btn">My Bets</button>
            </div>

            <div id="game-history-view" class="space-y-2">
                <div class="grid grid-cols-10 gap-2" id="history-dots">
                    </div>
            </div>

            <div id="my-history-view" class="hidden space-y-3">
                <p class="text-center text-xs text-slate-500 py-10">No recent activity found.</p>
            </div>
        </div>
    </div>

    <div id="modal-overlay" class="fixed inset-0 bg-black/95 z-[90] hidden flex items-center justify-center p-6">
        
        <div id="dep-panel" class="glass-panel w-full max-w-sm p-10 hidden animate-fade text-center border-t-4 border-red-600">
            <h3 class="text-3xl font-black text-red-600 italic mb-1">FUNDS UPLOAD</h3>
            <p class="text-[10px] text-slate-500 font-bold mb-8 uppercase tracking-widest">Scan QR & Enter Details</p>
            
            <div class="bg-white p-2 rounded-3xl w-60 h-60 mx-auto mb-8 shadow-2xl border-4 border-slate-900">
                <img id="admin-qr" src="" class="w-full h-full object-contain">
            </div>

            <div class="space-y-4">
                <input type="number" id="dep-amt" placeholder="Amount (Min â‚¹10)" class="w-full p-5 rounded-2xl font-black text-center text-xl">
                <input type="number" id="dep-utr" placeholder="12-Digit UTR Reference" class="w-full p-5 rounded-2xl font-black text-center tracking-[0.2em]">
                <button onclick="handleDepSubmit()" class="w-full bg-red-600 py-5 rounded-2xl font-black text-xl shadow-lg shadow-red-900/40 btn-beast">Verify Payment</button>
            </div>
            <button onclick="closeModal()" class="mt-8 text-slate-600 font-black text-[10px] uppercase tracking-widest">Abandon Mission</button>
        </div>

        <div id="wit-panel" class="glass-panel w-full max-w-sm p-10 hidden animate-fade text-center border-t-4 border-yellow-500">
            <h3 class="text-3xl font-black text-yellow-500 italic mb-1">WITHDRAWAL</h3>
            <p class="text-[10px] text-slate-500 font-bold mb-8 uppercase tracking-widest">Secure Fund Transfer</p>
            
            <div class="space-y-4 text-left">
                <label class="text-[10px] text-slate-500 font-black ml-4 uppercase">UPI Address</label>
                <input type="text" id="wit-upi" placeholder="example@upi" class="w-full p-5 rounded-2xl font-bold mb-2">
                
                <label class="text-[10px] text-slate-500 font-black ml-4 uppercase">Full Name</label>
                <input type="text" id="wit-name" placeholder="Official Bank Name" class="w-full p-5 rounded-2xl font-bold mb-2">
                
                <label class="text-[10px] text-slate-500 font-black ml-4 uppercase">Amount</label>
                <input type="number" id="wit-amt" placeholder="Min â‚¹10" class="w-full p-5 rounded-2xl font-black text-xl">
                
                <button onclick="handleWitSubmit()" class="w-full bg-yellow-500 text-black py-5 rounded-2xl font-black text-xl btn-beast shadow-lg shadow-yellow-500/20 mt-4">Execute Transfer</button>
            </div>
            <button onclick="closeModal()" class="mt-8 text-slate-600 font-black text-[10px] uppercase tracking-widest">Return to Battle</button>
        </div>
    </div>

    <script>
        /* --- 5.1 DATABASE CONFIGURATION --- */
        const firebaseConfig = {
            apiKey: "AIzaSyBdro-HbE-RSNvx4-ftDTTVLEH9ZAlmCBA",
            databaseURL: "https://yggame-23e85-default-rtdb.firebaseio.com",
            projectId: "yggame-23e85",
            appId: "1:805643944561:web:e445cb4d236b3e731c51d0"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        /* --- 5.2 GLOBAL STATE --- */
        let userState = JSON.parse(localStorage.getItem('yg_session'));
        let currentBet = null;
        let isMarketLocked = false;

        /* --- 5.3 AUTH LOGIC --- */
        function switchAuth(mode) {
            document.getElementById('reg-box').classList.toggle('hidden', mode === 'login');
            document.getElementById('log-box').classList.toggle('hidden', mode === 'reg');
        }

        async function handleRegister() {
            const ph = document.getElementById('reg-phone').value;
            const p1 = document.getElementById('reg-pass').value;
            const p2 = document.getElementById('reg-cpass').value;

            if (ph.length < 10) return alert("âŒ ERROR: Valid Phone Number Required.");
            if (p1 !== p2) return alert("âŒ ERROR: Passwords do not match.");
            if (p1.length < 4) return alert("âŒ ERROR: Password too short.");

            const check = await db.ref('users/' + ph).once('value');
            if (check.exists()) return alert("âš ï¸ BLOCKED: Mobile number already registered.");

            await db.ref('users/' + ph).set({
                phone: ph,
                pass: p1,
                wallet: 0,
                history: [],
                status: 'active'
            });
            alert("ðŸŽŠ REGISTERED! Login to start winning.");
            switchAuth('login');
        }

        async function handleLogin() {
            const ph = document.getElementById('log-phone').value;
            const ps = document.getElementById('log-pass').value;

            const snap = await db.ref('users/' + ph).once('value');
            if (!snap.exists()) return alert("âŒ DENIED: User not found.");
            if (snap.val().pass !== ps) return alert("âŒ DENIED: Wrong password.");

            initGame(snap.val());
        }

        function initGame(data) {
            userState = data;
            localStorage.setItem('yg_session', JSON.stringify(userState));
            document.getElementById('auth-layer').classList.add('hidden');
            document.getElementById('game-layer').classList.remove('hidden');
            document.getElementById('user-display').innerText = `TITAN_${userState.phone.slice(-4)}`;
            
            // Live Wallet listener
            db.ref('users/' + userState.phone + '/wallet').on('value', s => {
                userState.wallet = s.val() || 0;
                document.getElementById('balance-txt').innerText = userState.wallet.toFixed(2);
            });

            startEngine();
        }

        /* --- 5.4 BEAST ENGINE (TIMER & LOGIC) --- */
        function startEngine() {
            setInterval(() => {
                const now = new Date();
                const ist = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Kolkata"}));
                const sec = ist.getSeconds();
                const rem = 30 - (sec % 30);
                
                // PERIOD LOGIC (AS REQUESTED)
                const datePart = ist.toISOString().slice(0,10).replace(/-/g,"");
                const totalMin = ist.getHours() * 60 + ist.getMinutes();
                const pId = datePart + "1000" + (10001 + totalMin - 330) + (sec >= 30 ? "B" : "A");

                document.getElementById('period-id').innerText = pId;
                document.getElementById('timer-clock').innerText = `00:${rem < 10 ? '0'+rem : rem}`;

                // Lock buttons in last 5 seconds
                if (rem <= 5) {
                    isMarketLocked = true;
                    document.getElementById('big-btn').style.opacity = "0.4";
                    document.getElementById('small-btn').style.opacity = "0.4";
                } else {
                    isMarketLocked = false;
                    document.getElementById('big-btn').style.opacity = "1";
                    document.getElementById('small-btn').style.opacity = "1";
                }

                // Settle result
                if (rem === 1) {
                    setTimeout(() => resolveRound(pId), 1500);
                }
            }, 1000);
        }

        async function resolveRound(pId) {
            const forceSnap = await db.ref('control/force').once('value');
            const force = forceSnap.val();
            
            let res = (force && force !== 'Random') ? force : (Math.random() > 0.5 ? 'Big' : 'Small');
            
            // Update global history
            db.ref('history/' + pId).set(res);

            if (currentBet && currentBet.p === pId) {
                if (currentBet.type === res) {
                    const win = currentBet.amt * 1.96;
                    await db.ref('users/' + userState.phone + '/wallet').transaction(w => (w || 0) + win);
                    alert("ðŸŽŠ BOOM! WINNER! Result: " + res);
                } else {
                    alert("ðŸ’€ LOSS! Better luck next time. Result: " + res);
                }
                currentBet = null;
            }
            // Reset control
            db.ref('control/force').set('Random');
        }

        /* --- 5.5 BETTING SYSTEM --- */
        function bet(type) {
            if (isMarketLocked) return alert("â›” MARKET LOCKED: Please wait for next round.");
            if (userState.wallet < 1) return alert("ðŸ’¸ BROKE: Deposit at least â‚¹10.");

            const amountStr = prompt(`STAKE ON [${type}] - Minimum â‚¹1:`, "10");
            const amt = parseFloat(amountStr);

            if (amt >= 1 && amt <= userState.wallet) {
                const pid = document.getElementById('period-id').innerText;
                db.ref('users/' + userState.phone + '/wallet').transaction(w => w - amt);
                currentBet = { type: type, amt: amt, p: pid };
                
                // Alert Admin of live bet
                db.ref('admin_feed').push({ phone: userState.phone, type, amt, pid });
                alert(`ðŸŽ¯ BET SET: â‚¹${amt} on ${type}`);
            } else {
                alert("âŒ INVALID: Insufficient balance or amount.");
            }
        }

        /* --- 5.6 MODAL & TRANSACTIONS --- */
        function openModal(type) {
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.getElementById('dep-panel').classList.toggle('hidden', type !== 'dep');
            document.getElementById('wit-panel').classList.toggle('hidden', type !== 'wit');
            
            if (type === 'dep') {
                db.ref('control/qr').on('value', s => document.getElementById('admin-qr').src = s.val());
            }
        }
        function closeModal() { document.getElementById('modal-overlay').classList.add('hidden'); }

        async function handleDepSubmit() {
            const amt = parseFloat(document.getElementById('dep-amt').value);
            const utr = document.getElementById('dep-utr').value;

            if (amt >= 10 && utr.length === 12) {
                await db.ref('requests/deposits').push({
                    phone: userState.phone, amt, utr, status: 'Pending', time: Date.now()
                });
                alert("â³ PLEASE WAIT PATIENTLY: Your amount will be added after checking your payment.");
                closeModal();
            } else { alert("âŒ ERROR: Min â‚¹10 and 12-digit UTR required."); }
        }

        async function handleWitSubmit() {
            const upi = document.getElementById('wit-upi').value;
            const name = document.getElementById('wit-name').value;
            const amt = parseFloat(document.getElementById('wit-amt').value);

            if (amt >= 10 && amt <= userState.wallet && upi && name) {
                await db.ref('users/' + userState.phone + '/wallet').transaction(w => w - amt);
                await db.ref('requests/withdrawals').push({
                    phone: userState.phone, upi, name, amt, status: 'Pending', time: Date.now()
                });
                alert("âœ… SUCCESS: Withdrawal request sent to Titan Admin.");
                closeModal();
            } else { alert("âŒ ERROR: Insufficient balance or missing details."); }
        }

        /* --- 5.7 HISTORY & TAB UI --- */
        function switchTab(t) {
            document.getElementById('tab-game').classList.toggle('active', t === 'game');
            document.getElementById('tab-my').classList.toggle('active', t === 'my');
            document.getElementById('game-history-view').classList.toggle('hidden', t !== 'game');
            document.getElementById('my-history-view').classList.toggle('hidden', t !== 'my');
        }

        db.ref('history').limitToLast(20).on('value', s => {
            const box = document.getElementById('history-dots');
            box.innerHTML = "";
            let data = [];
            s.forEach(c => data.unshift({p: c.key, r: c.val()}));
            
            data.forEach(item => {
                const color = item.r === 'Big' ? 'bg-orange-600' : 'bg-indigo-600';
                box.innerHTML += `<div class="${color} w-8 h-8 rounded-lg flex items-center justify-center text-[10px] font-black">${item.r[0]}</div>`;
            });
        });

        /* --- 5.8 SYSTEM --- */
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loader').classList.add('hidden');
                    if (userState) initGame(userState);
                    else document.getElementById('auth-layer').classList.remove('hidden');
                }, 700);
            }, 1500);
        };

        function logout() { localStorage.clear(); location.reload(); }
    </script>
</body>
</html>
